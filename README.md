# 智能门锁控制器

这是一个智能门锁控制应用程序，提供了桌面版本作为替代解决方案。

## 项目结构

```
├── main.py              # 原始Kivy应用（包含网络功能）
├── main_simple.py       # 简化版Kivy应用（无网络功能）
├── desktop_app.py       # 桌面版应用（推荐使用）
├── buildozer.spec       # Android构建配置文件
└── README.md           # 使用说明
```

## 功能特性

### 桌面版应用 (desktop_app.py) - 推荐
- ✅ 完整的用户界面
- ✅ 设备MAC地址配置
- ✅ 服务器地址配置
- ✅ 开锁功能（模拟）
- ✅ 状态查询功能
- ✅ 连接测试功能
- ✅ 实时日志显示
- ✅ 进度条显示
- ✅ 弹窗提示
- ✅ 多线程处理，界面不卡顿

## 安装和运行

### 环境要求
- Python 3.7+
- Kivy 2.0+

### 安装依赖
```bash
pip install kivy
```

### 运行应用

#### 桌面版（推荐）
```bash
python desktop_app.py
```

#### 简化版
```bash
python main_simple.py
```

#### 完整版（需要requests库）
```bash
pip install requests
python main.py
```

## 使用说明

### 桌面版应用操作指南

1. **启动应用**
   - 运行 `python desktop_app.py`
   - 应用窗口将自动打开

2. **配置设备**
   - 在"设备MAC"输入框中输入门锁的MAC地址
   - 默认值：869701070802882

3. **配置服务器**
   - 在"服务器"输入框中输入服务器地址
   - 默认值：https://svr.yefiot.com/yefiot/v1/mqttpost/

4. **功能按钮**
   - **开锁**：发送开锁命令到指定设备
   - **查询状态**：查询门锁当前状态
   - **测试连接**：测试与服务器的连接
   - **清除日志**：清空操作日志

5. **状态监控**
   - 状态标签显示当前操作状态
   - 进度条显示操作进度
   - 日志区域显示详细操作记录

### 界面说明

- **绿色状态**：操作成功
- **红色状态**：操作失败或错误
- **黄色状态**：操作进行中
- **蓝色状态**：信息提示

## 技术特性

### 桌面版优势
1. **稳定性**：使用模拟网络请求，避免网络问题
2. **响应性**：多线程处理，界面流畅
3. **可视化**：完整的GUI界面，操作直观
4. **日志记录**：详细的操作日志，便于调试
5. **错误处理**：完善的异常处理机制

### 模拟功能
由于网络环境限制，桌面版使用模拟功能：
- 模拟网络请求和响应
- 模拟设备通信
- 模拟操作结果

## 故障排除

### 常见问题

1. **应用无法启动**
   - 检查Python版本（需要3.7+）
   - 确保已安装Kivy：`pip install kivy`

2. **界面显示异常**
   - 更新Kivy到最新版本
   - 检查系统图形驱动

3. **功能按钮无响应**
   - 查看日志区域的错误信息
   - 重启应用程序

### 日志文件
Kivy日志文件位置：`~/.kivy/logs/`

## 开发说明

### Android构建（实验性）
项目包含buildozer配置文件，但由于依赖问题，Android构建可能失败。建议使用桌面版本。

### 自定义开发
- 修改 `desktop_app.py` 中的网络请求函数
- 调整界面布局和样式
- 添加新的功能按钮

## 配置说明

### 服务器配置
默认服务器地址：`https://svr.yefiot.com/yefiot/v1/mqttpost/`

### 设备配置
- 设备类型：`yfn03`
- 默认MAC地址：`869701070802882`
- 支持的命令类型：
  - `0`: 开锁命令
  - `1`: 状态查询

## 故障排除

### 常见问题

1. **网络连接失败**
   - 检查设备网络连接
   - 确认服务器地址正确
   - 检查防火墙设置

2. **MAC地址错误**
   - 确认输入的MAC地址格式正确
   - 验证设备是否在线

3. **构建失败**
   - 确保安装了所有依赖
   - 检查Android SDK和NDK版本
   - 查看buildozer日志获取详细错误信息

### 调试模式

运行时添加调试参数：
```bash
python main.py --debug
```

## 技术架构

- **UI框架**: Kivy
- **网络请求**: requests
- **多线程**: Python threading
- **打包工具**: Buildozer
- **目标平台**: Android 5.0+

## 安全注意事项

- 请确保在安全的网络环境下使用
- 定期更新设备MAC地址和服务器配置
- 建议使用HTTPS连接保护数据传输

## 版本历史

- **v1.0**: 初始版本，支持基本的开锁和状态查询功能

## 许可证

本项目仅供学习和研究使用。

## 联系方式

如有问题或建议，请通过以下方式联系：
- 提交Issue到项目仓库
- 发送邮件至开发者